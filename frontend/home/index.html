<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>銘柄無料診断</title>
<meta http-equiv="Content-Type" content="text/html;">
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" type="text/css" href="/static/jp_jqr/css/style.css">
<script src="/static/jp_jqr/js/jquery.js"></script>
<script src="/static/jp_jqr/js/index.js"></script>
<link href="/static/css/layui.css" rel="stylesheet">
<script src="/static/js/layui.js"></script>
<script src="/static/js/jquery-3.7.1.min.js"></script>
<script src="/static/core/jp_202573.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-17509989440"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'AW-17509989440');
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JSL8CMEDKD"></script>
<script>
    function gtag_report_conversion(url) {
        var callback = function () {
            if (typeof (url) != 'undefined') {
                window.location = url;
            }
        };
        gtag('event', 'Add', {
            'event_category': 'engagement',
            'event_label': 'conversion',
            'value': 1
        });
        gtag('event', 'conversion', {
            'send_to': 'AW-17509989440/7fCjCKHGsq0bEMD4tJ1B',
            'value': 1.0,
            'currency': 'USD',
            'event_callback': callback
        });
        return false;
    }
</script>
</head>
<body>
    <div class="tan_div box_bg80" id="SonContent0" style="display: none;">
        <div class="tan_content tan_400">
            <div class="tan_title">
                <span class="discuss"></span>
                <div class="barbox">
                    <div class="barline">
                        <div style="width:0px;" class="charts"></div>
                        <div style="width:0px;" class="charts1"></div>
                        <div style="width:0px;" class="charts2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dialog5">
		<div class="tan_close"></div>
        <div class="con" style="    margin-top: 20px;
    font-size: 23px;
    line-height: 1.8;
    color: #333;
    padding: 30px;">
          ご入力いただいた <span class="gName" style="font-weight:bold; color:#e74c3c;font-size: 25px;"></span> について、
          モメンタム分析・リアルタイムデータ・AIロジックをもとに診断を行いました。<br>
          <div id="price-info" style="">
            現在の株価は <span class="price" style="font-size: 25px;font-weight: bold; color: rgb(220, 56, 37);">1540</span> 円、
            前日比 <span class="change" style="font-size: 25px;color: rgb(220, 56, 37);">+28.00</span> 円（<span class="changesPercentage" style="color: rgb(220, 56, 37);font-size: 25px;">(+1.85%)</span>）<br>
          </div>
          私たちのスタッフ、 「<span style="color:#0078d7; font-weight:bold;">AIアシスタント</span>」のLINEアカウントを追加してください。
          <br>
          追加が完了しましたら、詳細な診断レポートを受け取るために、銘柄コード「<span class="gNmae" style="color:#d72600; font-weight:bold;">アネスト岩田</span>」または「<span id="gCode" style="color:#d72600; font-weight:bold;">6381.T</span>」 と送信してください。<br>
          <span style="background: #fffbe6; padding: 6px 10px; display: inline-block; border-radius: 6px;">
            メッセージを送信した瞬間にAI診断が始まり、<strong>最新レポートが即座に届きます。カスタマーサポートを追加すると、AI診断分析の結果として、今週136％以上上昇した銘柄も配信されます。</strong>
          </span>
        </div>
    <div class="dialog5_btn pulse animated infinite bold " id="tcSureBtn" onclick="addjoin('受け取る加人')"><p style="margin-left:5rem;"><span class="sType">診断</span>レポートをLINEで受け取る</p></div>
    </div>
    <div class="zhegai"></div>

    <div class="main">
        <div class="content">
            <div class="lwtop">
                <video autoplay muted loop playsinline preload="auto" id="backgroundVideo" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1;">
                    <source src="static/jp_jqr/image/backgroundvideo.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="lvtt">
                    <div class="bt">
                        <img src="static/jp_jqr/image/lw_t_bt.webp">
                        <div class="top-code-name">
                            <span class="tcn-s1"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="head">
                <div class="data-bg">
                    <div class="row">
                        <div class="gupiao">
                            <div class="t1">
                                <div class="gName"></div>
                                <div class="gCode center"></div>
                                <div class="time" id="new_data"></div>
                            </div>
                            <div class="t2">
                                <div class="arrow"> <span class="price"></span> <img src="static/jp_jqr/image/arrow.webp">
                                </div>
                                <div> <span class="change red"></span> <span class="changesPercentage red"></span> </div>
                            </div>
                        </div>
                        <div class="stockinfo">
                            <div class="tablecontent">
                                <table style="border-spacing: 0px 10px;height:300px;">
                                    <thead>
                                        <tr>
                                            <th>始値</th>
                                            <th>高値</th>
                                            <th>終値</th>
                                        </tr>
                                    </thead>
                                    <tbody class="border">
                                        <tr>
                                            <td class="open"></td>
                                            <td class="dayHigh"></td>
                                            <td class="previousClose"></td>
                                        </tr>
                                        <tr style="height: 12px">
                                            <td style="height: 12px;"></td>
                                        </tr>
                                    </tbody>
                                    <thead style="margin-top:20px;">
                                        <tr>
                                            <th>安値</th>
                                            <th>売買高</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="dayLow"></td>
                                            <td class="volume"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
				<div id="btngo" class="btnBg submitBtn1 center pulse animated infinite"><span class="tcname" style="display: inline;color:#f00"></span>・診断開始</div>
            </div>
			<div class="lwc2">
			<div class="table1bg">
                    <div class="tableOverflow ">
                        <table class="tableList"></table>
                    </div>

                </div>
                <div class="btnBox-bg" style="padding-top:30px;">
                    <div id="btngo" class="btnBg submitBtn2 center pulse animated infinite"><span class="tcname" style="display: inline;color:#f00"></span>・株価分析</div>
                </div>
                <div class="lwc21">
                    <img src="static/jp_jqr/image/table.png" alt="Table Image" style="display: block; margin: 0 auto; max-width: 100%;">
                </div>

            </div>
			<div id="btngo" class="btnBg submitBtn3 center pulse animated infinite"><span class="tcname" style="display: inline;color:#f00"></span>株価・AI予測</div>


        </div>
		<div class="footer">
                <p>Copyright © エックスピーエー株式会社 2025</p>
                <p>住所：東京都港区赤坂2丁目5−1</p>
                <p>ＴＥＬ：03-3505-3961</p>
                <p>MAIL：frankalexander3800@hotmail.com</p>
		</div>
        <div class="error-box"><strong>エラー:</strong> 銘柄コードの取得に失敗しました!</div>
    </div>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var currentDomain = window.location.hostname;
      $(".current-domain").each(function () {
        $(this).text(currentDomain);
      });
    })
    var pageid = 911562;
    loadStockData()
    function upTrackingData(id) {
      const data = {
        id: id,
      };
      const endpoint = '/app/maike/api/info/uppage_track';
      fetch(endpoint, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
        .then(response => response.json())
        .then(data => {
          console.log('Success:', data);
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    }
    function BtnTracking(text, click_type = 0) {
      console.log(text)
      if (text == '' || text == undefined || text == null || text == 'null') {
        text = '点击按钮';
      }
      const data = {
        url: text + window.location.href,
        timestamp: new Date().toISOString(),
        click_type: click_type
      };
      var timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      var language = navigator.language || navigator.userLanguage;
      const endpoint = '/app/maike/api/info/page_track';
      fetch(endpoint, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'timezone': timezone,
          'language': language
        },
        body: JSON.stringify(data)
      })
        .then(response => response.json())
        .then(data => {
          console.log('Success:', data);
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    }
    function getQueryVariable(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split("=");
        if (pair[0] == variable) {
          return pair[1];
        }
      }
      return (false);
    }
    function loadStockData() {
      const stockcode = getQueryVariable("code") || '^N225';
      var timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      var language = navigator.language || navigator.userLanguage;

      $.ajax({
        url: '/app/maike/api/stock/getinfo',
        data: { code: stockcode },
        headers: {
          Accept: "application/json; charset=utf-8",
          timezone: timezone,
          language: language
        },
        type: "get",
        success: function (res) {
          console.log('API Response:', res);

          const result = res.chart?.result?.[0];
          if (!result) {
            console.error('Invalid data format:', res);
            return;
          }

          const meta = result.meta || {};
          const quote = result.indicators?.quote?.[0] || {};
          const adjclose = result.indicators?.adjclose?.[0] || {};

          // 更新页面元素
          $('.gName,.btnBg span,.tcodeName').html(meta.stockName || '--');
          $('.gCode').text('(' + (meta.stockCode || '--') + ')');
          $('.sCode').text(meta.stockCode || '--');
          $('.price').text(quote.close ?? '--');
          $('.open').text(quote.open ?? '--');
          $('.dayHigh').text(quote.high ?? '--');
          $('.dayLow').text(quote.low ?? '--');
          $('.previousClose').text(meta.chartPreviousClose ?? '--');
          $('.volume').text(quote.volume ?? '--');
          $('.chengjiaoe').text(adjclose.adjclose ?? '--');
          $('.zhenfu').text(meta.lowPrice ?? '--');

          // 计算涨跌值和涨跌百分比
          const closePrice = quote.close ?? 0;
          const previousClose = meta.chartPreviousClose ?? 0;

          let changeValue = 0;
          let changePercentage = 0;

          if (closePrice !== undefined && previousClose !== undefined) {
            changeValue = (closePrice - previousClose).toFixed(2);
            changePercentage = ((changeValue / previousClose) * 100).toFixed(2);

            $('.change').text(changeValue > 0 ? `+${changeValue}` : changeValue);
            $('.changesPercentage').text(changeValue > 0 ? `(+${changePercentage}%)` : `(${changePercentage}%)`);

            if (changeValue > 0) {
              $('.change, .changesPercentage').css('color', '#dc3825');
            } else {
              $('.change, .changesPercentage').css('color', '#03a20c');
            }
          } else {
            $('.change').text('--');
            $('.changesPercentage').text('--');
          }

          // 调用 updateCarousel 来填充历史数据表格
          if (res.historical_data && meta.stockCode && meta.stockName) {
            updateCarousel(res.historical_data, meta.stockName, meta.stockCode);
          }

          console.log('Close Price:', quote.close);
          console.log('Open Price:', quote.open);
          console.log('High Price:', quote.high);
          console.log('Low Price:', quote.low);
          console.log('Volume:', quote.volume);
          console.log('Adjusted Close:', adjclose.adjclose);
          console.log('Change Value:', changeValue);
          console.log('Change Percentage:', changePercentage);
        },
        error: function (e) {
          console.error('Error loading stock data:', e);
        }
      });
    }
    function updateCarousel(historicalData, companyName, stockCode) {
        // 清空 tableList
        $('.tableList').empty();

        // 遍历历史数据并生成表格行
        let newTr = "";
        historicalData.forEach((item) => {
            const colorClass = item.change > 0 ? 'red' : 'green';
            newTr = `
                <tr>
                    <td class="td1">株 | ${stockCode}<br><span>${item.date}</span></td>
                    <td class="td2">終値：<span class="${colorClass}">${item.close}</span>${companyName}<br>前日比：<span class="${colorClass}">${item.change} (${item.change_percent}%)</span><br></td>
                </tr>`;
            $('.tableList').append(newTr);
        });

        // 调用滚动表格函数
        scrollTable();
    }

    function scrollTable() {
        var i = 1;
        var len = $('.tableList tr').length;

        // 克隆表格行以实现无缝滚动
        $('.tableList').append($('.tableList tr').clone());
        var _table = $('.tableList').eq(0);

        // 设置定时器实现滚动效果
        setInterval(function () {
            _table.css('marginTop', -108 * i);
            i++;
            if (i == len + 1) {
                setTimeout(function () {
                    _table.css('transition', 'none');
                    _table.css('marginTop', -6);
                    i = 1;
                    setTimeout(function () {
                        _table.css('transition', 'all .7s');
                    }, 700);
                }, 1000);
            }
        }, 2500);
    }
  </script>
    <script>
	var width = parseInt(window.screen.width);
	var scale = width / 750;
	$('#viewport').attr('content', 'width=640,user-scalable=no,initial-scale=' + scale);
	</script>
</body>
</html>
